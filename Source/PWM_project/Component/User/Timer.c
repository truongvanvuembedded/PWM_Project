//==================================================================================================
//
//	File Name		Drv_GPIO_Output.c
//	CPU Type		ESP32-S3-WROOM-1
//	Builder 		ESP-IDF V5.3.1
//					
//	Customer		
//	Coding			V.Vu 
//	History			Ver.0.01	2024.12.12	V.Vu New
//	Memo			Output driver
//
//==================================================================================================
//==================================================================================================
//	#pragma section
//==================================================================================================

//==================================================================================================
//	Local Compile Option
//==================================================================================================

//==================================================================================================
//	Header File
//==================================================================================================
#include <stdio.h>
#include "main.h"
#include "RamDef.h"
#include "DataDef.h"
#include "FuncDef.h"
//==================================================================================================
//	Local define
//==================================================================================================
//==================================================================================================
//	Local define I/O
//==================================================================================================

//==================================================================================================
//	Local Struct Template
//==================================================================================================

//==================================================================================================
//	Local RAM 
//==================================================================================================
static uint8_t u1_Duty_PWM_Temp;
static uint8_t u1_Freq_PWM_Temp;
//==================================================================================================
//	Local ROM
//==================================================================================================

//==================================================================================================
//	Local Function Prototype
//==================================================================================================

//==================================================================================================
//	Source Code
//==================================================================================================
////////////////////////////////////////////////////////////////////////////////////////////////////
//	Name:	        Timer_Init
//	Function:	    Init 
//	Argument:	    -
//	Return value:	-
//	Create:	        2024.11.27 V.Vu	New
//  Change:	        -
//	Remarks:	    -
//
////////////////////////////////////////////////////////////////////////////////////////////////////
void Timer_Init( void )
{
  // Init timer 
  st_MainLoop.u1_Cnt = 0;
  st_MainLoop.u1_Flag = 0;

  // PWM
	st_CH1_ProFile.u4_FreqValue = (uint32_t)0;
	st_CH1_ProFile.u1_DutyValue = 0;

  u1_Duty_PWM_Temp = st_CH1_ProFile.u1_DutyValue;
  u1_Freq_PWM_Temp = st_CH1_ProFile.u4_FreqValue;
}
////////////////////////////////////////////////////////////////////////////////////////////////////
//	Name:	        Timer_Delay
//	Function:	    Init 
//	Argument:	    -
//	Return value:	-
//	Create:	        2024.11.27 V.Vu	New
//  Change:	        -
//	Remarks:	    -
//
////////////////////////////////////////////////////////////////////////////////////////////////////
void PWM_Change( void )
{
  uint32_t au4_RegTemp;

  if ( u1_Duty_PWM_Temp != st_CH1_ProFile.u1_DutyValue )
  {
    u1_Duty_PWM_Temp = st_CH1_ProFile.u1_DutyValue;
    au4_RegTemp = TIM1->ARR;
    au4_RegTemp = ((au4_RegTemp * u1_Duty_PWM_Temp) / 100);
    TIM1->CCR2 = (au4_RegTemp - 1);
  }
}
/* ************************************* End of File ******************************************** */

